<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VIDRO ART MUZ - Orçamentos</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    /* Definindo as novas cores */
    :root {
      --main-green: #1E8449; /* Verde principal um pouco mais escuro */
      --dark-bg: #1a1a1a;
      --light-text: #f8f9fa;
      --light-gray: #f0f0f0;
      --border-color: #cccccc;
      --text-color: #333333;
    }

    body {
      font-family: 'Open Sans', sans-serif; /* Fonte mais suave para o corpo */
      background-color: var(--dark-bg); /* Preto suave */
      color: var(--light-text); /* Off-white para o texto padrão */
      line-height: 1.6;
      /* Efeito de iluminação verde no topo, ajustado para o novo tom */
      background-image: linear-gradient(to bottom, rgba(30, 132, 73, 0.3), rgba(30, 132, 73, 0) 30%, var(--dark-bg) 60%);
      background-attachment: fixed; /* Para que o gradiente fique fixo no topo da viewport */
      background-repeat: no-repeat;
      background-position: top center;
      background-size: 100% 100vh; /* Ocupa a largura total e a altura da viewport */
    }
    h1, h2, h3, h4 {
      font-family: 'Montserrat', sans-serif; /* Montserrat para títulos */
    }

    .glass-card {
      backdrop-filter: blur(15px); /* Blur mais sutil */
      background: rgba(255, 255, 255, 0.08); /* Fundo quase transparente, mais elegante */
      border-radius: 1.25rem; /* Bordas mais arredondadas */
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); /* Sombra mais pronunciada */
      transition: all 0.4s ease-in-out;
    }
    .glass-card:hover {
      transform: translateY(-8px) scale(1.01); /* Efeito de "levantar" mais acentuado */
      box-shadow: 0 15px 45px rgba(0, 0, 0, 0.4);
      background: rgba(255, 255, 255, 0.12); /* Levemente mais opaco no hover */
    }

    .input-field {
      width: 100%;
      background: rgba(0, 0, 0, 0.4); /* Fundo mais transparente */
      border-radius: 0.5rem; /* Bordas mais arredondadas */
      padding: 0.75rem 1rem; /* Padding maior */
      outline: none;
      color: var(--light-text); /* Off-white */
      transition: background 0.3s ease, box-shadow 0.3s ease;
      border: none;
    }
    .input-field::placeholder {
      color: rgba(255, 255, 255, 0.6); /* Placeholder mais suave */
    }
    .input-field:focus {
      background: rgba(0, 0, 0, 0.6); /* Fundo um pouco mais escuro no foco */
      box-shadow: 0 0 0 3px var(--main-green); /* Sombra verde principal no foco */
    }
    .input-field[type="checkbox"] {
        background: rgba(0, 0, 0, 0.5);
        color: var(--main-green); /* Verde principal para o check */
        appearance: none; /* Remover estilo padrão */
        -webkit-appearance: none;
        -moz-appearance: none;
        width: 1.25rem; /* Tamanho maior */
        height: 1.25rem;
        border-radius: 0.25rem;
        cursor: pointer;
        position: relative;
        display: inline-block;
        vertical-align: middle;
        border: none;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.3); /* Borda interna sutil */
    }
    .input-field[type="checkbox"]:checked {
        background-color: var(--main-green); /* Verde principal quando checado */
        box-shadow: inset 0 0 0 1px var(--main-green); /* Sombra interna verde */
    }
    .input-field[type="checkbox"]:checked::before {
        content: '\2713'; /* Ícone de check */
        display: block;
        color: white;
        font-size: 0.8rem;
        text-align: center;
        line-height: 1.25rem;
    }
    /* Estilo específico para o input de cor */
    .input-field[type="color"] {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      width: 40px; /* Largura menor para a caixa de cor */
      height: 40px; /* Altura menor para a caixa de cor */
      border: none;
      padding: 0;
      background: none;
      cursor: pointer;
      border-radius: 0.5rem; /* Bordas arredondadas */
      overflow: hidden; /* Para garantir que a cor preencha o border-radius */
    }
    .input-field[type="color"]::-webkit-color-swatch-wrapper {
      padding: 0;
    }
    .input-field[type="color"]::-webkit-color-swatch {
      border: none;
      border-radius: 0.5rem;
    }
    .input-field[type="color"]::-moz-color-swatch-wrapper {
      padding: 0;
    }
    .input-field[type="color"]::-moz-color-swatch {
      border: none;
      border-radius: 0.5rem;
    }


    .btn-green {
      background-color: var(--main-green); /* Verde principal */
      color: white;
      padding: 0.8rem 2rem; /* Padding maior */
      border-radius: 0.5rem; /* Bordas mais arredondadas */
      display: inline-flex; /* Usar inline-flex para centralizar ícone e texto */
      gap: 0.75rem; /* Espaçamento maior */
      align-items: center;
      font-weight: 600;
      letter-spacing: 0.05em; /* Espaçamento entre letras */
      text-transform: uppercase; /* Texto em maiúsculas */
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
      box-shadow: 0 4px 15px rgba(30, 132, 73, 0.4); /* Ajustado para o novo verde */
      border: none; /* Remover borda */
    }
    .btn-green:hover {
      background-color: #186F3E; /* Verde escuro no hover */
      transform: translateY(-3px); /* Efeito de "levantar" */
      box-shadow: 0 6px 20px rgba(30, 132, 73, 0.6);
    }
    .btn-black {
      background-color: #343a40; /* Cinza escuro */
      color: var(--light-text); /* Off-white */
      padding: 0.8rem 2rem;
      border-radius: 0.5rem;
      display: inline-flex;
      gap: 0.75rem;
      align-items: center;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
      box-shadow: 0 4px 15px rgba(52, 58, 64, 0.4);
      border: none; /* Remover borda */
    }
    .btn-black:hover {
      background-color: var(--dark-bg); /* Preto suave no hover */
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(52, 58, 64, 0.6);
    }

    .product-item {
      display: flex;
      align-items: center;
      gap: 1.5rem; /* Espaçamento maior */
      padding: 1.25rem; /* Padding maior */
      background: rgba(0, 0, 0, 0.3); /* Fundo mais transparente */
      border-radius: 0.75rem; /* Bordas mais arredondadas */
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); /* Sombra mais suave */
      transition: all 0.3s ease-in-out;
      border: none; /* Remover borda */
    }
    .product-item:hover {
      transform: scale(1.01);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      background: rgba(0, 0, 0, 0.4);
    }
    .product-item img {
      width: 80px; /* Tamanho maior */
      height: 80px;
      object-fit: cover;
      border-radius: 0.5rem; /* Bordas mais arredondadas */
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3); /* Sombra sutil na imagem */
    }
    .product-item p {
        color: var(--light-text); /* Off-white */
    }
    .product-item p.font-semibold {
        color: var(--light-text); /* Off-white */
        font-size: 1.1rem; /* Fonte maior */
    }
    .product-item p.text-sm {
        color: rgba(255, 255, 255, 0.7); /* Texto menor mais suave */
    }
    .product-item p.text-md {
        color: #6cda80; /* Manter um verde claro para destaque de valor */
        font-weight: 700; /* Mais negrito */
        font-size: 1.15rem; /* Fonte maior */
    }
    .product-item button {
        color: #dc3545; /* Vermelho para o lixo */
        font-size: 1.4rem; /* Ícone maior */
        transition: color 0.2s ease;
    }
    .product-item button:hover {
        color: #c82333; /* Vermelho mais escuro no hover */
    }
    .product-item .color-box {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      display: inline-block;
      vertical-align: middle;
      margin-right: 5px; /* Espaçamento à direita para separar do texto */
    }

    /* Animações de entrada */
    .animate-fade-in {
      animation: fadeIn 1s ease-out forwards;
      opacity: 0;
    }
    .animate-slide-up {
      animation: slideUp 1s ease-out forwards;
      opacity: 0;
      transform: translateY(30px);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Ajustes para o fundo da seção de orçamento */
    #orcamento {
        background-color: transparent; /* Fundo transparente para ver o gradiente do body */
        color: var(--light-text); /* Off-white */
    }
    #orcamento h3 {
        color: var(--light-text); /* Título da seção off-white */
    }
    #produtosAdicionadosContainer h4 {
        color: var(--light-text); /* Título dos produtos adicionados off-white */
        border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* Linha divisória sutil */
    }
    #noProductsMessage {
        color: rgba(255, 255, 255, 0.6); /* Mensagem de nenhum produto mais suave */
    }
    .flex.items-center.gap-2 label {
        color: var(--light-text); /* Label do checkbox off-white */
    }
    hr {
        border-color: rgba(255, 255, 255, 0.1); /* Linha divisória mais escura e sutil */
    }

    /* Ajuste para o cabeçalho */
    header {
      background-color: transparent; /* Fundo transparente para ver o gradiente do body */
      padding-top: 1.5rem; /* py-6 */
      padding-bottom: 1.5rem;
      box-shadow: none; /* Remover sombra */
    }
    header .max-w-7xl { /* Remover max-width e padding laterais do container interno do header */
        max-width: none;
        padding-left: 0;
        padding-right: 0;
    }
    header h1, header nav { /* Adicionar padding interno para o texto do header */
        padding-left: 2rem; /* px-8 */
        padding-right: 2rem; /* px-8 */
    }
    header h1 {
        font-size: 2.5rem; /* Título maior */
        font-weight: 700;
        letter-spacing: 0.08em; /* Mais espaçamento */
    }
    header nav a {
        font-weight: 600;
        font-size: 1.1rem;
        padding: 0.5rem 1rem;
        border-radius: 0.3rem;
        transition: background-color 0.3s ease, color 0.3s ease;
    }
    header nav a:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: var(--main-green); /* Verde principal no hover */
    }


    /* Ajuste para a seção hero */
    .hero-section { /* Nova classe para a seção hero */
      background-color: transparent; /* Fundo transparente para ver o gradiente do body */
      padding-left: 0; /* Remover padding lateral */
      padding-right: 0; /* Remover padding lateral */
      padding-top: 8rem; /* Más padding */
      padding-bottom: 8rem; /* Más padding */
      box-shadow: none; /* Remover sombra */
    }
    .hero-section > div { /* Adicionar padding interno para o conteúdo do hero */
        max-width: 4xl; /* Aumentar o max-width para el contenido */
        margin-left: auto;
        margin-right: auto;
        padding-left: 2rem; /* px-8 */
        padding-right: 2rem; /* px-8 */
    }
    .hero-section h2 {
        font-size: 3.8rem; /* Título mayor */
        font-weight: 700;
        line-height: 1.2;
        text-shadow: none; /* Remover sombra */
        margin-bottom: 1.5rem;
    }
    .hero-section p {
        font-size: 1.4rem; /* Texto mayor */
        opacity: 0.95;
        text-shadow: none; /* Remover sombra */
    }

    /* Ajuste para a seção de orçamento */
    #orcamento {
        padding-top: 5rem; /* py-20 */
        padding-bottom: 5rem;
        background-color: transparent; /* Fundo transparente para ver o gradiente do body */
    }
    #orcamento > div { /* Adicionar padding interno para o conteúdo do orçamento */
        max-width: 5xl; /* Manter o max-width para el contenido */
        margin-left: auto;
        margin-right: auto;
        padding-left: 2rem; /* px-8 */
        padding-right: 2rem; /* px-8 */
    }
    #orcamento h3 {
        font-size: 3rem; /* Título mayor */
        font-weight: 700;
        margin-bottom: 3rem; /* Espaçamento mayor */
        text-shadow: none; /* Remover sombra */
    }


    /* Ajuste para o rodapé */
    footer {
      background-color: transparent; /* Fundo transparente para ver o gradiente do body */
      color: var(--light-text); /* Off-white */
      text-align: center;
      padding: 2.5rem; /* Padding mayor */
      margin-top: 6rem; /* Espaçamento mayor do conteúdo */
      box-shadow: none; /* Remover sombra */
      padding-left: 0; /* Remover padding lateral */
      padding-right: 0; /* Remover padding lateral */
    }
    footer p { /* Adicionar padding interno para o texto do rodapé */
        padding-left: 2rem; /* px-8 */
        padding-right: 2rem; /* px-8 */
        font-size: 0.95rem;
        opacity: 0.8;
    }
  </style>
</head>
<body class="min-h-screen"> 
  <header class="text-white py-6">
    <div class="max-w-7xl mx-auto px-4 flex justify-between items-center">
      <h1 class="text-3xl font-bold tracking-wide">VIDRO ART MUZ</h1>
      <nav class="space-x-6 text-lg">
        <a href="#orcamento" class="hover:underline">Orçamento</a>
      </nav>
    </div>
  </header>

  <section class="text-center py-20 px-4 hero-section text-white">
    <div class="max-w-3xl mx-auto p-8 rounded-2xl animate-fade-in">
      <h2 class="text-5xl font-bold mb-4 leading-tight">A Referência em Soluções de Vidro para Residências e Empresas</h2>
      <p class="text-xl opacity:90">Portas, janelas, box e projetos sob medida para sua casa ou empresa.</p>
    </div>
  </section>

  <section id="orcamento" class="py-16">
    <div class="max-w-6xl mx-auto px-4">
      <h3 class="text-4xl font-bold text-center mb-12 animate-slide-up">Painel de Geração de Orçamentos</h3>
      <div class="glass-card p-10 animate-slide-up">
        <form class="space-y-8" onsubmit="return false;">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <input type="text" id="clienteNome" placeholder="Nome do Cliente" class="input-field">
            <input type="text" id="clienteTelefone" placeholder="Telefone" class="input-field">
            <input type="email" id="clienteEmail" placeholder="E-mail" class="input-field">
            <input type="text" id="clienteEndereco" placeholder="Endereço da Obra" class="input-field">
            <div class="flex items-center gap-2">
              <input type="checkbox" id="pagamentoAVista" class="input-field">
              <label for="pagamentoAVista" class="font-medium">Pagamento à Vista (3% de desconto)</label>
            </div>
          </div>
          <hr class="my-8">
          <div class="grid grid-cols-1 gap-6">
            <input type="text" id="produtoNome" placeholder="Produto (ex: Box Incolor 8mm)" class="input-field">
            <div class="grid grid-cols-2 gap-6">
              <input type="number" id="produtoLargura" placeholder="Largura (mm)" class="input-field">
              <input type="number" id="produtoAltura" placeholder="Altura (mm)" class="input-field">
            </div>
            <input type="number" id="produtoQtd" placeholder="Quantidade" value="1" class="input-field">
            <input type="text" id="produtoVidro" placeholder="Vidro (ex: temperado, fumê, etc.)" class="input-field">
            <input type="number" step="0.01" id="produtoArea" placeholder="Área Total (m²)" class="input-field">
            <input type="number" step="0.01" id="produtoUnitario" placeholder="Valor Unitário (R$)" class="input-field">
            <input type="number" step="0.01" id="produtoTotal" placeholder="Valor Total (R$)" class="input-field">
            
            <!-- CAMPO DE COR -->
            <div class="flex items-center gap-4">
              <label for="produtoCor" class="font-medium text-gray-300">Cor:</label>
              <input type="color" id="produtoCor" value="#ffffff" class="input-field">
              <input type="text" id="produtoCorNome" placeholder="Nome da Cor (ex: Bronze, Fumê)" class="input-field flex-grow">
            </div>
            <!-- FIM CAMPO DE COR -->

            <input type="file" accept="image/*" id="produtoFoto" class="input-field">
          </div>
          <div class="flex justify-center gap-6 pt-4">
            <button type="button" class="btn-green" onclick="adicionarProduto()"><i class="fas fa-plus mr-2"></i> Adicionar Produto</button>
            <button type="button" class="btn-black" onclick="gerarPDF()"><i class="fas fa-file-pdf mr-2"></i> Gerar Orçamento</button>
          </div>
        </form>

        <div id="produtosAdicionadosContainer" class="mt-12 space-y-6 animate-slide-up">
          <h4 class="text-2xl font-bold border-b-2 pb-2">Produtos Adicionados:</h4>
          <div id="listaProdutos" class="space-y-4">
            <!-- Produtos adicionados serão listados aqui -->
            <p class="text-gray-500" id="noProductsMessage">Nenhum produto adicionado ainda.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer class="text-white text-center py-8 mt-20">
    <p class="text-sm">&copy; 2025 VIDRO ART MUZ. Todos os direitos reservados.</p>
  </footer>

  <script>
    // Array para armazenar os produtos adicionados
    let produtosAdicionados = [];

    // Função para adicionar um produto à lista
    async function adicionarProduto() {
      const nomeProduto = document.getElementById("produtoNome").value;
      const largura = document.getElementById("produtoLargura").value;
      const altura = document.getElementById("produtoAltura").value;
      const qtd = document.getElementById("produtoQtd").value;
      const vidro = document.getElementById("produtoVidro").value;
      const area = document.getElementById("produtoArea").value;
      const unitario = document.getElementById("produtoUnitario").value;
      const total = document.getElementById("produtoTotal").value;
      const fotoFile = document.getElementById("produtoFoto").files[0];
      const corHex = document.getElementById("produtoCor").value; // Captura o valor HEX da cor
      const corNome = document.getElementById("produtoCorNome").value; // Captura o nome da cor
      let fotoDataURL = '';

      // Validação básica dos campos (ajustada para incluir os novos campos de cor como opcionais)
      if (!nomeProduto || !largura || !altura || !qtd || !vidro || !area || !unitario || !total) {
        alert("Por favor, preencha todos os campos obrigatórios do produto antes de adicionar.");
        return;
      }

      // Converte a imagem para DataURL se houver uma
      if (fotoFile) {
        fotoDataURL = await new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = (e) => resolve(e.target.result);
          reader.readAsDataURL(fotoFile);
        });
      }

      // Cria o objeto do novo produto
      const novoProduto = {
        nome: nomeProduto,
        largura: largura,
        altura: altura,
        quantidade: qtd,
        vidro: vidro,
        area: area,
        valorUnitario: unitario,
        valorTotal: total,
        foto: fotoDataURL,
        corHex: corHex, // Adiciona a cor HEX
        corNome: corNome // Adiciona o nome da cor
      };

      // Adiciona o produto ao array
      produtosAdicionados.push(novoProduto);
      // Atualiza a exibição na página
      renderizarProdutosAdicionados();
      // Limpa os campos do formulário de produto
      limparCamposProduto();
    }

    // Função para renderizar os produtos adicionados na página
    function renderizarProdutosAdicionados() {
      const listaProdutosDiv = document.getElementById("listaProdutos");
      listaProdutosDiv.innerHTML = ''; // Limpa a lista existente

      if (produtosAdicionados.length === 0) {
        listaProdutosDiv.innerHTML = '<p class="text-gray-500" id="noProductsMessage">Nenhum produto adicionado ainda.</p>';
        return;
      }

      // Remove a mensagem "Nenhum produto adicionado" se houver produtos
      document.getElementById("noProductsMessage")?.remove(); 

      // Adiciona cada produto à lista na página
      produtosAdicionados.forEach((produto, index) => {
        const productItemDiv = document.createElement('div');
        productItemDiv.className = 'product-item';
        productItemDiv.innerHTML = `
          ${produto.foto ? `<img src="${produto.foto}" alt="${produto.nome}">` : ''}
          <div>
            <p class="font-semibold">${produto.nome} (${produto.largura}x${produto.altura}mm)</p>
            <p class="text-sm">Qtd: ${produto.quantidade} | Vidro: ${produto.vidro}
            ${produto.corNome ? ` | Cor: <span class="color-box" style="background-color: ${produto.corHex};"></span>${produto.corNome}` : ''}
            | Área: ${produto.area}m²</p>
            <p class="text-md font-bold">Valor Unitário: R$ ${parseFloat(produto.valorUnitario).toFixed(2)} | Valor Total: R$ ${parseFloat(produto.valorTotal).toFixed(2)}</p>
          </div>
          <button type="button" class="text-red-500 hover:text-red-700 ml-auto transition-colors duration-200" onclick="removerProduto(${index})">
            <i class="fas fa-trash-alt text-lg"></i>
          </button>
        `;
        listaProdutosDiv.appendChild(productItemDiv);
      });
    }

    // Função para remover um produto da lista
    function removerProduto(index) {
      produtosAdicionados.splice(index, 1); // Remove o produto do array
      renderizarProdutosAdicionados(); // Renderiza a lista novamente
    }

    // Função para limpar os campos do formulário de produto
    function limparCamposProduto() {
      document.getElementById("produtoNome").value = '';
      document.getElementById("produtoLargura").value = '';
      document.getElementById("produtoAltura").value = '';
      document.getElementById("produtoQtd").value = '1';
      document.getElementById("produtoVidro").value = '';
      document.getElementById("produtoArea").value = '';
      document.getElementById("produtoUnitario").value = '';
      document.getElementById("produtoTotal").value = '';
      document.getElementById("produtoFoto").value = ''; // Limpa o input de arquivo
      document.getElementById("produtoCor").value = '#ffffff'; // Reseta a cor para branco
      document.getElementById("produtoCorNome").value = ''; // Limpa o nome da cor
    }

    // Função principal para gerar o PDF
    async function gerarPDF() {
      if (produtosAdicionados.length === 0) {
        alert("Por favor, adicione pelo menos um produto ao orçamento antes de gerar o PDF.");
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF("p", "mm", "a4");
      const margin = 8; // Margem geral ainda mais reduzida
      let y = margin;
      const lineSpacing = 3.8; // Espaçamento entre linhas ainda mais reduzido
      const sectionPadding = 4; // Espaçamento interno das seções ainda mais reduzido
      const headerColor = '#1E8449'; // Verde principal um pouco mais escuro
      const textColor = '#333333'; // Cor de texto padrão
      const lightGray = '#f0f0f0'; // Fundo de seções
      const borderColor = '#cccccc'; // Cor da borda

      // URL do logo (SUBSTITUA PELA URL DIRETA DO SEU LOGO)
      const logoUrl = 'https://image.prntscr.com/image/GGaFu3YNs5gE.png'; 
      let logoImg = null;

      if (logoUrl) {
        try {
          const response = await fetch(logoUrl);
          const blob = await response.blob();
          logoImg = await new Promise(resolve => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(blob);
          });
        } catch (error) {
          console.error("Erro ao carregar o logo:", error);
          // Opcional: alertar o usuário ou usar um fallback de texto
        }
      }

      // --- Cabeçalho do Documento ---
      doc.setFillColor(headerColor);
      doc.rect(0, 0, doc.internal.pageSize.width, 22, 'F'); // Faixa verde no topo reduzida

      if (logoImg) {
        doc.addImage(logoImg, 'PNG', margin, 2, 16, 16); // Ajuste posição e tamanho conforme necessário
      } else {
        // Fallback de texto se o logo não carregar
        doc.setFontSize(14); // Fonte menor para o fallback
        doc.setTextColor(255, 255, 255); // Branco
        doc.setFont(undefined, "bold");
        doc.text("VIDRO ART MUZ", margin, 13); // Título da empresa
      }

      doc.setFontSize(8); // Fonte menor para informações de contato
      doc.setTextColor(255, 255, 255); // Branco
      doc.setFont(undefined, "normal");
      doc.text("Avenida Frei Florentino, 214, Centro, Muzambinho", doc.internal.pageSize.width - margin, 4, { align: "right" });
      doc.text("CNPJ: 00.000.000/0001-00", doc.internal.pageSize.width - margin, 8, { align: "right" });
      doc.text("Telefone: (35)3571-5750", doc.internal.pageSize.width - margin, 12, { align: "right" });
      doc.text("Email: vidroartmuz@gmail.com", doc.internal.pageSize.width - margin, 16, { align: "right" });

      y = 27; // Posição inicial após o cabeçalho

      // --- Título "ORÇAMENTO" Centralizado e Estilizado ---
      const titleText = "ORÇAMENTO";
      const titleFontSize = 20; // Aumentar um pouco a fonte
      doc.setFontSize(titleFontSize);
      doc.setTextColor(headerColor);
      doc.setFont(undefined, "bold");

      // Calcular a largura do texto para centralizar
      const textWidth = doc.getStringUnitWidth(titleText) * titleFontSize / doc.internal.scaleFactor;
      const centerX = (doc.internal.pageSize.width - textWidth) / 2;

      // Desenhar um retângulo de fundo para o título
      const titleRectHeight = 9; // Altura do retângulo
      const titleRectWidth = textWidth + 8; // Largura do retângulo um pouco maior que o texto
      const titleRectX = (doc.internal.pageSize.width - titleRectWidth) / 2;
      const titleRectY = y - 2; // Posição Y do retângulo, um pouco acima do texto

      doc.setFillColor(lightGray); // Fundo cinza claro para o título
      doc.rect(titleRectX, titleRectY, titleRectWidth, titleRectHeight, 'F');
      doc.setDrawColor(headerColor); // Borda verde
      doc.setLineWidth(0.5);
      doc.rect(titleRectX, titleRectY, titleRectWidth, titleRectHeight, 'S');

      doc.setTextColor(headerColor); // Cor do texto do título
      doc.text(titleText, centerX, y + 4); // Ajustar Y para centralizar verticalmente no retângulo
      y += titleRectHeight + 4; // Espaçamento após o título estilizado
      doc.setDrawColor(headerColor);
      doc.setLineWidth(0.4);
      doc.line(margin, y, doc.internal.pageSize.width - margin, y); // Linha divisória
      y += 5; // Espaçamento reduzido

      // --- Dados do Cliente ---
      doc.setFillColor(lightGray);
      doc.rect(margin, y, doc.internal.pageSize.width - 2 * margin, 32, 'F'); // Aumentado para incluir data e número
      doc.setDrawColor(borderColor);
      doc.rect(margin, y, doc.internal.pageSize.width - 2 * margin, 32, 'S'); // Borda

      doc.setFontSize(9); // Fonte menor
      doc.setTextColor(headerColor);
      doc.setFont(undefined, "bold");
      doc.text("DADOS DO CLIENTE", margin + sectionPadding, y + sectionPadding);

      doc.setFontSize(8); // Fonte menor
      doc.setTextColor(textColor);
      doc.setFont(undefined, "normal");
      doc.text(`Nome: ${document.getElementById("clienteNome").value}`, margin + sectionPadding, y + sectionPadding + 4);
      doc.text(`Telefone: ${document.getElementById("clienteTelefone").value}`, margin + sectionPadding, y + sectionPadding + 8);
      doc.text(`E-mail: ${document.getElementById("clienteEmail").value}`, margin + sectionPadding, y + sectionPadding + 12);
      doc.text(`Endereço da Obra: ${document.getElementById("clienteEndereco").value}`, margin + sectionPadding, y + sectionPadding + 16);
      
      // --- Data e Número do Orçamento ---
      const hoje = new Date();
      const dataOrcamento = hoje.toLocaleDateString('pt-BR');
      const numeroOrcamento = Math.floor(Math.random() * 1000000); // Gera um número aleatório simples

      doc.text(`Data: ${dataOrcamento}`, margin + sectionPadding, y + sectionPadding + 20);
      doc.text(`Orçamento Nº: ${numeroOrcamento}`, margin + sectionPadding, y + sectionPadding + 24);

      y += 32 + 5; // Atualiza Y, espaçamento ajustado

      // --- Seção de Produtos ---
      doc.setFillColor(headerColor);
      doc.rect(margin, y, doc.internal.pageSize.width - 2 * margin, 5, 'F'); // Altura reduzida
      doc.setFontSize(9); // Fonte menor
      doc.setTextColor(255, 255, 255);
      doc.setFont(undefined, "bold");
      doc.text("PRODUTOS", margin + sectionPadding, y + 3.5); // Ajuste de posição
      y += 8; // Espaçamento reduzido

      let totalGeralOrcamento = 0;

      // Altura fixa para cada item de produto para garantir 3 por página.
      const productItemFixedHeight = 47; // Mantido em 47mm

      for (let i = 0; i < produtosAdicionados.length; i++) {
        const produto = produtosAdicionados[i];

        // Verifica se há espaço suficiente para o próximo produto
        if (y + productItemFixedHeight + 5 > doc.internal.pageSize.height - margin - 45) { // -45 para o rodapé
            doc.addPage();
            y = margin; // Reinicia Y na nova página

            // Repete o cabeçalho da página
            doc.setFillColor(headerColor);
            doc.rect(0, 0, doc.internal.pageSize.width, 22, 'F');
            if (logoImg) {
                doc.addImage(logoImg, 'PNG', margin, 2, 16, 16);
            } else {
                doc.setFontSize(14);
                doc.setTextColor(255, 255, 255);
                doc.setFont(undefined, "bold");
                doc.text("VIDRO ART MUZ", margin, 13);
            }
            doc.setFontSize(8);
            doc.setTextColor(255, 255, 255);
            doc.setFont(undefined, "normal");
            doc.text("Avenida Frei Florentino, 214, Centro, Muzambinho", doc.internal.pageSize.width - margin, 4, { align: "right" });
            doc.text("CNPJ: 00.000.000/0001-00", doc.internal.pageSize.width - margin, 8, { align: "right" });
            doc.text("Telefone: (35)3571-5750", doc.internal.pageSize.width - margin, 12, { align: "right" });
            doc.text("Email: vidroartmuz@gmail.com", doc.internal.pageSize.width - margin, 16, { align: "right" });
            y = 27;

            // Repete o título "ORÇAMENTO" estilizado na nova página
            doc.setFontSize(titleFontSize);
            doc.setTextColor(headerColor);
            doc.setFont(undefined, "bold");
            const textWidthPage2 = doc.getStringUnitWidth("ORÇAMENTO (continuação)") * titleFontSize / doc.internal.scaleFactor;
            const centerXPage2 = (doc.internal.pageSize.width - textWidthPage2) / 2;
            const titleRectWidthPage2 = textWidthPage2 + 8;
            const titleRectXPage2 = (doc.internal.pageSize.width - titleRectWidthPage2) / 2;
            doc.setFillColor(lightGray);
            doc.rect(titleRectXPage2, y - 2, titleRectWidthPage2, titleRectHeight, 'F');
            doc.setDrawColor(headerColor);
            doc.setLineWidth(0.5);
            doc.rect(titleRectXPage2, y - 2, titleRectWidthPage2, titleRectHeight, 'S');
            doc.setTextColor(headerColor);
            doc.text("ORÇAMENTO (continuação)", centerXPage2, y + 4);
            y += titleRectHeight + 4;
            doc.setDrawColor(headerColor);
            doc.setLineWidth(0.4);
            doc.line(margin, y, doc.internal.pageSize.width - margin, y);
            y += 5;

            doc.setFillColor(headerColor);
            doc.rect(margin, y, doc.internal.pageSize.width - 2 * margin, 5, 'F');
            doc.setFontSize(9);
            doc.setTextColor(255, 255, 255);
            doc.setFont(undefined, "bold");
            doc.text("PRODUTOS (continuação)", margin + sectionPadding, y + 3.5);
            y += 8;
        }

        // Desenha a borda do item do produto
        const productItemStart = y;
        doc.setDrawColor(borderColor);
        doc.setLineWidth(0.2);
        doc.rect(margin, y, doc.internal.pageSize.width - 2 * margin, productItemFixedHeight - 2, 'S'); // Usar altura fixa

        doc.setFontSize(7.5); // Fonte menor para detalhes do produto
        doc.setTextColor(textColor);
        doc.setFont(undefined, "normal");

        let currentProductY = y + sectionPadding / 2;
        const textStartX = margin + sectionPadding;
        const imageStartX = margin + sectionPadding;
        const imageSize = 40; // Tamanho da imagem no PDF AINDA MAIOR

        if (produto.foto) {
          const img = new Image();
          img.src = produto.foto;
          await new Promise(resolve => img.onload = resolve); 

          doc.addImage(img, "JPEG", imageStartX, currentProductY, imageSize, imageSize);
          
          // Posição do texto ao lado da imagem
          let textOffset = imageSize + 3; // Espaço da imagem + um pequeno gap
          let tempTextY = currentProductY + 2; // Ajuste para alinhar com o topo da imagem

          doc.setFont(undefined, "bold");
          doc.text(`${i + 1}. ${produto.nome}`, textStartX + textOffset, tempTextY);
          doc.setFont(undefined, "normal");
          tempTextY += lineSpacing;
          doc.text(`L x A: ${produto.largura}x${produto.altura}mm | Vidro: ${produto.vidro}`, textStartX + textOffset, tempTextY);
          tempTextY += lineSpacing;
          if (produto.corNome) {
            doc.setFillColor(produto.corHex);
            doc.rect(textStartX + textOffset, tempTextY - 3.5, 3, 3, 'F'); // Quadrado de cor menor
            doc.text(`Cor: ${produto.corNome}`, textStartX + textOffset + 5, tempTextY);
            tempTextY += lineSpacing;
          }
          // Combinando Qtd, Área e V. Unitário em uma linha para economizar espaço
          doc.text(`Qtd: ${produto.quantidade} | Área: ${produto.area}m² | V. Unit: R$ ${parseFloat(produto.valorUnitario).toFixed(2)}`, textStartX + textOffset, tempTextY);
          tempTextY += lineSpacing + 1;
          doc.setFont(undefined, "bold");
          doc.text(`VALOR TOTAL: R$ ${parseFloat(produto.valorTotal).toFixed(2)}`, textStartX + textOffset, tempTextY);
          doc.setFont(undefined, "normal");

          y = productItemStart + productItemFixedHeight; // Atualiza Y para o próximo item
        } else {
          // Texto do produto sem imagem
          let tempTextY = currentProductY + 2; // Ajuste para alinhar com o topo da caixa

          doc.setFont(undefined, "bold");
          doc.text(`${i + 1}. ${produto.nome}`, textStartX, tempTextY);
          doc.setFont(undefined, "normal");
          tempTextY += lineSpacing;
          doc.text(`L x A: ${produto.largura}x${produto.altura}mm | Vidro: ${produto.vidro}`, textStartX, tempTextY);
          tempTextY += lineSpacing;
          if (produto.corNome) {
            doc.setFillColor(produto.corHex);
            doc.rect(textStartX, tempTextY - 3.5, 3, 3, 'F'); // Quadrado de cor menor
            doc.text(`Cor: ${produto.corNome}`, textStartX + 5, tempTextY);
            tempTextY += lineSpacing;
          }
          // Combinando Qtd, Área e V. Unitário em uma linha para economizar espaço
          doc.text(`Qtd: ${produto.quantidade} | Área: ${produto.area}m² | V. Unit: R$ ${parseFloat(produto.valorUnitario).toFixed(2)}`, textStartX, tempTextY);
          tempTextY += lineSpacing + 1;
          doc.setFont(undefined, "bold");
          doc.text(`VALOR TOTAL: R$ ${parseFloat(produto.valorTotal).toFixed(2)}`, textStartX, tempTextY);
          doc.setFont(undefined, "normal");

          y = productItemStart + productItemFixedHeight; // Atualiza Y para o próximo item
        }
        totalGeralOrcamento += parseFloat(produto.valorTotal);
        y += 2; // Espaçamento entre os itens reduzido
      }

      // --- Resumo do Orçamento ---
      y += 5; // Espaçamento antes do resumo reduzido
      doc.setDrawColor(borderColor);
      doc.setLineWidth(0.4); // Linha mais fina
      doc.line(doc.internal.pageSize.width - margin - 60, y, doc.internal.pageSize.width - margin, y); // Linha acima do subtotal

      doc.setFontSize(8.5); // Fonte menor
      doc.setTextColor(textColor);
      doc.setFont(undefined, "normal");
      doc.text(`SUBTOTAL:`, doc.internal.pageSize.width - margin - 55, y + lineSpacing, { align: "left" });
      doc.text(`R$ ${totalGeralOrcamento.toFixed(2)}`, doc.internal.pageSize.width - margin, y + lineSpacing, { align: "right" });
      y += lineSpacing;

      const isPagamentoAVista = document.getElementById("pagamentoAVista").checked;
      const percentualDesconto = 0.03; // 3%
      let valorDesconto = 0;
      let valorFinalComDesconto = totalGeralOrcamento;

      if (isPagamentoAVista) {
          valorDesconto = totalGeralOrcamento * percentualDesconto;
          valorFinalComDesconto = totalGeralOrcamento - valorDesconto;
          doc.text(`DESCONTO (3% à vista):`, doc.internal.pageSize.width - margin - 55, y + lineSpacing, { align: "left" });
          doc.text(`- R$ ${valorDesconto.toFixed(2)}`, doc.internal.pageSize.width - margin, y + lineSpacing, { align: "right" });
          y += lineSpacing;
      }

      doc.setDrawColor(headerColor);
      doc.setLineWidth(0.7); // Linha mais grossa
      doc.line(doc.internal.pageSize.width - margin - 60, y + lineSpacing / 2, doc.internal.pageSize.width - margin, y + lineSpacing / 2); // Linha mais grossa

      doc.setFontSize(10.5); // Fonte maior para o valor final
      doc.setTextColor(headerColor);
      doc.setFont(undefined, "bold");
      doc.text(`VALOR FINAL:`, doc.internal.pageSize.width - margin - 55, y + lineSpacing + 3, { align: "left" });
      doc.text(`R$ ${valorFinalComDesconto.toFixed(2)}`, doc.internal.pageSize.width - margin, y + lineSpacing + 3, { align: "right" });
      y += lineSpacing + 5;

      // --- Formas de Pagamento ---
      doc.setFontSize(8.5);
      doc.setTextColor(headerColor);
      doc.setFont(undefined, "bold");
      doc.text("FORMAS DE PAGAMENTO:", margin, y);
      doc.setFont(undefined, "normal");
      doc.setTextColor(textColor);
      doc.text("Cartão de Crédito/Débito, Pix, Boleto, Cheque", margin, y + lineSpacing);
      y += lineSpacing * 2; // Espaçamento após as formas de pagamento

      // --- Rodapé para Assinaturas ---
      // Ajuste a posição Y para que as linhas de assinatura fiquem mais acima
      y = doc.internal.pageSize.height - margin - 20; // Posição fixa mais acima do final da página

      doc.setDrawColor(borderColor);
      doc.setLineWidth(0.4); // Linha mais fina
      doc.line(margin + 10, y, margin + 70, y); // Linha para assinatura do cliente
      doc.line(doc.internal.pageSize.width - margin - 70, y, doc.internal.pageSize.width - margin - 10, y); // Linha para assinatura da empresa

      doc.setFontSize(7); // Fonte menor
      doc.setTextColor(textColor);
      doc.text("Assinatura do Cliente", margin + 20, y + 3);
      doc.text("Assinatura da VIDRO ART MUZ", doc.internal.pageSize.width - margin - 60, y + 3);

      // Número da página (se houver mais de uma página, isso precisaria ser dinâmico)
      doc.setFontSize(6.5); // Fonte menor
      doc.setTextColor(150);
      doc.text(`Página 1 de 1`, doc.internal.pageSize.width / 2, doc.internal.pageSize.height - 6, { align: "center" });


      window.open(doc.output("bloburl"), "_blank");
    }
  </script>
</body>
</html>
```
